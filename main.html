<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>EmberLight Game</title>
    <link rel="stylesheet" href="https://unpkg.com/leopard@^1/dist/index.min.css" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: black;
      }

      #project {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: top left;
      }
    </style>
  </head>
  <body>
    <div id="project"></div>

    <script type="module">
      import project from "./index.js";

      // Attach project
      project.attach("#project");

      // Scale project to fit window
      function scaleProject() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        const scale = Math.min(width / 480, height / 360);
        const projectDiv = document.getElementById("project");
        projectDiv.style.transform = `translate(-50%, -50%) scale(${scale})`;
      }

      scaleProject();
      window.addEventListener("resize", scaleProject);

      // Start project logic
      project.greenFlag();

      // Play music automatically using the browser-friendly loop
      const titleScreen = project.sprites.TitleScreen;
      if (titleScreen) {
        // Non-blocking loop using setInterval
        function playMusicLoop() {
          const sound = titleScreen.sounds.find(s => s.name === "emberlight-titlescreen");
          if (!sound) return;
          // create an audio element
          const audio = new Audio(sound.asset.url || "./emberlight-titlescreen.wav");
          audio.loop = true;
          audio.volume = 1;
          audio.play().catch(() => {
            // In case autoplay is blocked, resume on first user interaction
            document.body.addEventListener("click", () => audio.play(), { once: true });
          });
        }

        playMusicLoop();
      }
    </script>
  </body>
</html>
