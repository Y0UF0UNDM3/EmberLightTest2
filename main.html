<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>EmberLight Game</title>
    <link rel="stylesheet" href="https://unpkg.com/leopard@^1/dist/index.min.css" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: black;
      }

      #wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: top left;
      }

      #project {
        width: 480px;   /* original Leopard width */
        height: 360px;  /* original Leopard height */
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="project"></div>
    </div>

    <script type="module">
      import project from "./index.js";

      // Attach project
      project.attach("#project");

      // Start project logic
      project.greenFlag();

      // Music setup
      const audio = new Audio("./emberlight-titlescreen.wav");
      audio.loop = true;
      audio.volume = 1;
      let musicStarted = false;

      function playMusic() {
        if (!musicStarted) {
          audio.play().catch(() => {
            // If autoplay is blocked, do nothing; user click will trigger it
          });
          musicStarted = true;
        }
      }

      // Try autoplay immediately
      playMusic();

      // Fallback: start music on first click (only once)
      document.body.addEventListener("click", playMusic, { once: true });

      // Scaling & centering
      const wrapper = document.getElementById("wrapper");
      function scaleProject() {
        const scale = Math.min(window.innerWidth / 480, window.innerHeight / 360);
        wrapper.style.transform = `translate(-50%, -50%) scale(${scale})`;
      }

      scaleProject();
      window.addEventListener("resize", scaleProject);

      // Re-center continuously in case Leopard changes canvas size dynamically
      function updateCenter() {
        scaleProject();
        requestAnimationFrame(updateCenter);
      }
      requestAnimationFrame(updateCenter);
    </script>
  </body>
</html>
